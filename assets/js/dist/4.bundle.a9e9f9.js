webpackJsonp([4,13],{269:function(e,a,t){"use strict";function r(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}(),n=t(25),l=t(35),i=function(){function e(){r(this,e);$("#shopCartSale").off("click").on("click",function(e){$(this).find(".my-dropdown").slideToggle("3500")}),$("#shopCartSale").find("nav").off("click").on("click",function(e){e.stopPropagation()}),$(document).off("mouseup").on("mouseup",function(e){var a=$(".my-dropdown");a.is(e.target)||0!==a.has(e.target).length||a.hide()})}return o(e,[{key:"get",value:function(){var e=this;$.get((0,n.base_url)()+"ajax/add_cart",function(a){e.templateCart(a)})}},{key:"delete",value:function(e){var a=this;$.ajax({url:(0,n.base_url)()+"ajax/delete_cart/",data:{rowid:e},type:"post"}).done(function(e){a.templateCart(e)}).fail(function(e){})}},{key:"templateCart",value:function(e){var a=this;$("#shopCartSale").find("span").attr("data-venta",e.count);var t=document.getElementById("template-venta").innerHTML,r=Mustache.render(t,e);if(document.getElementById("listaVenta").innerHTML=r,(0,l.format_numeric)("init"),localStorage.setItem("precio",e.total),localStorage.setItem("enganche",e.enganche),localStorage.setItem("abono",e.abono),e.is_reserva?(localStorage.setItem("id_reserva",e.id_reserva),localStorage.setItem("id_lider",e.id_lider),localStorage.setItem("nombre_lider",e.nombre_lider),localStorage.setItem("nombre_cliente",e.nombre_cliente),localStorage.setItem("apellidos_cliente",e.apellidos_cliente),localStorage.setItem("email_cliente",e.email_cliente),localStorage.setItem("phone_cliente",e.phone_cliente),localStorage.setItem("comment",e.comment),localStorage.setItem("is_reserva",!0)):(localStorage.removeItem("id_reserva"),localStorage.removeItem("id_lider"),localStorage.removeItem("nombre_lider"),localStorage.removeItem("nombre_cliente"),localStorage.removeItem("apellidos_cliente"),localStorage.removeItem("email_cliente"),localStorage.removeItem("phone_cliente"),localStorage.removeItem("comment"),localStorage.setItem("is_reserva",!1)),$("#frm-venta #precio").length&&$("#frm-venta #enganche").length&&$("#frm-venta #abono").length&&$("#comision").length){$("#frm-venta #precio").autoNumeric("set",localStorage.getItem("precio")),$("#frm-venta #enganche").autoNumeric("set",localStorage.getItem("enganche")),$("#frm-venta #abono").autoNumeric("set",localStorage.getItem("abono"));var o=$("#porcentaje_comision").val();$("#frm-venta #comision").autoNumeric("set",o/100*$("#precio").autoNumeric("get")),e.is_reserva?($("#first_name").val(localStorage.getItem("nombre_cliente")),$("#last_name").val(localStorage.getItem("apellidos_cliente")),$("#id_lider").val(localStorage.getItem("id_lider")),$("#lideres_autocomplete").val(localStorage.getItem("nombre_lider")),$("#email").val(localStorage.getItem("email_cliente")),$("#phone").val(localStorage.getItem("phone_cliente")),localStorage.getItem("comment")?$("#comments").show().html(localStorage.getItem("comment")):$("#comments").hide().html(""),$("#id_reserva").val(localStorage.getItem("id_reserva"))):($("#first_name").val(""),$("#last_name").val(""),$("#id_lider").val(""),$("#lideres_autocomplete").val(""),$("#email").val(""),$("#phone").val(""),$("#comments").hide().empty(),$("#id_reserva").val(""))}else $("#frm-reserva #precio").length&&$("#frm-reserva #enganche").length&&$("#frm-reserva #abono").length&&($("#frm-reserva #precio").autoNumeric("set",localStorage.getItem("precio")),$("#frm-reserva #enganche").autoNumeric("set",localStorage.getItem("enganche")),$("#frm-reserva #abono").autoNumeric("set",localStorage.getItem("abono")));if(!e.count){var i=window.location.pathname,s=i.split("/"),c=s[s.length-1];"venta"!=c&&"reserva"!=c||(window.location.href=(0,n.base_url)())}$(".itemCartDelete").off("click").on("click",function(e){var t=$(this).val();a.delete(t),e.stopPropagation()})}}]),e}();a.default=i},275:function(e,a,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t(181),t(184);var o=t(25),n=t(182),l=(r(n),t(269)),i=r(l);t(183),t(36),t(185);var s=t(0),c=r(s);c.default.locale("es");var m,d=new i.default,u=$("#reservas-table").DataTable({ajax:(0,o.base_url)()+"ajax/get_reservas",columns:[{data:"id_reserva"},{data:"nombre_lider"},{data:"descripcion"},{data:"detalles"},{data:"expira",render:$.fn.dataTable.render.moment("DD-MM-YYYY")},{data:"",render:function(e,a,t,r){var o='<button class="btn btn-danger cancelar-reserva">Eliminar</button>';return 1==t.is_admin?o+' <button class="btn btn-primary aplicar-reserva">Aplicar</button> <button class="btn btn-warning btn-extender-reserva">Prorroga</button>':o}}],columnDefs:[{targets:-1,data:null,defaultContent:""},{sortable:!1,targets:[-1,3]}]});$("#reservas-table").on("click",".cancelar-reserva",function(){m=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev("tr.parent"):$(this).parents("tr");var e=u.row(m).data(),a={id_reserva:e.id_reserva};swal({title:"Eliminar reserva",text:"Esta a punto de eliminar una reserva, ¿Desea continuar?",type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,cancelButtonText:"CANCELAR"},function(){$.ajax({url:(0,o.base_url)()+"reserva/eliminar",data:a,type:"post"}).done(function(e){u.row(m).remove().draw();var a=$("#reservas-badge").html();$("#reservas-badge").html(a-1),swal("Hechó","¡Reserva eliminada!","success")}).fail(function(e){swal("¡Error!","La operación que intentó realizar ha fallado, contactar al administador sí el error persiste","error")})})}),$("#reservas-table").on("click",".aplicar-reserva",function(){m=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev("tr.parent"):$(this).parents("tr");var e=u.row(m).data(),a={id_reserva:e.id_reserva};swal({title:"Aplicar reserva",text:"Esta a punto de aplicar una reserva, se limpiará el carrito ¿Desea continuar?",type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,cancelButtonText:"CANCELAR"},function(){$.ajax({url:(0,o.base_url)()+"ajax/aplicar_reserva/",data:a,type:"post"}).done(function(a){var t=u.row(m).data(e).draw(!1).node();$(t).css({backgroundColor:"yellow"}),d.get(),swal("Hechó","¡Reserva aplicada!","success")}).fail(function(e){swal("¡Error!","La operación que intentó realizar ha fallado, contactar al administador sí el error persiste","error")})})});var v=void 0;$("#reservas-table").on("click",".btn-extender-reserva",function(){$("#modalEditarReserva").modal("show"),v=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev("tr.parent"):$(this).parents("tr");var e=u.row(v).data(),a=$("#expira");a.mask("00-00-0000");var t=(0,c.default)(e.expira,"YYYY-MM-DD");console.log(e.expira),console.log(t),a.datepicker({dateFormat:"dd-mm-yy",minDate:t.format("DD-MM-YYYY")}),a.val("").val(t.format("DD-MM-YYYY")),$("#id_reserva").val(e.id_reserva)}),$("#frm-extender-reserva").on("submit",function(e){e.preventDefault(),swal({title:"¿Esta seguro?",text:"Extenderá la fecha de reserva de los huertos",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, continuar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(){$.ajax({data:{id_reserva:$("#id_reserva").val(),expira:$("#expira").val()},url:(0,o.base_url)()+"ajax/update_reserva",method:"post"}).done(function(e){var a=u.row(v).data(e.data).draw().node();$(a).css({backgroundColor:"yellow"}),swal("Hecho","Datos actualizados correctamente","success"),$("#modalEditarReserva").modal("hide")}).fail(function(){swal("Error","Ha sucedido un error insperado, contacte al administrador","error")})})})}});